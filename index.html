<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>bevy-osm-tiles - Interactive OSM City Loader</title>
        <meta
            name="description"
            content="Interactive 3D OpenStreetMap city visualization built with Rust and Bevy"
        />
        <style>
            body {
                margin: 0;
                padding: 0;
                background: #1a1a1a;
                color: white;
                font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
                overflow: hidden;
            }

            #loading {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                z-index: 1000;
                transition: opacity 0.5s ease-out;
            }

            #loading.hidden {
                opacity: 0;
                pointer-events: none;
            }

            .loading-spinner {
                width: 50px;
                height: 50px;
                border: 5px solid rgba(255, 255, 255, 0.3);
                border-top: 5px solid white;
                border-radius: 50%;
                animation: spin 1s linear infinite;
                margin-bottom: 20px;
            }

            @keyframes spin {
                0% {
                    transform: rotate(0deg);
                }
                100% {
                    transform: rotate(360deg);
                }
            }

            .loading-text {
                font-size: 24px;
                margin-bottom: 10px;
                font-weight: bold;
            }

            .loading-subtext {
                font-size: 16px;
                opacity: 0.9;
                text-align: center;
                max-width: 500px;
                line-height: 1.6;
            }

            #error {
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(255, 0, 0, 0.9);
                padding: 30px;
                border-radius: 15px;
                display: none;
                z-index: 1001;
                max-width: 600px;
                text-align: center;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            }

            #error h2 {
                margin-top: 0;
                color: white;
                font-size: 24px;
            }

            #error p {
                color: #ffcccc;
                margin-bottom: 25px;
                font-size: 16px;
            }

            #error button {
                background: white;
                color: red;
                border: none;
                padding: 12px 25px;
                border-radius: 8px;
                cursor: pointer;
                font-weight: bold;
                font-size: 16px;
                transition: background 0.3s ease;
            }

            #error button:hover {
                background: #f0f0f0;
                transform: translateY(-1px);
            }

            canvas {
                display: block;
                width: 100vw;
                height: 100vh;
            }

            .header-links {
                position: fixed;
                top: 20px;
                right: 20px;
                display: flex;
                gap: 15px;
                z-index: 100;
            }

            .header-link {
                background: rgba(0, 0, 0, 0.7);
                color: white;
                padding: 10px 15px;
                border-radius: 8px;
                text-decoration: none;
                font-size: 14px;
                transition: all 0.3s ease;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .header-link:hover {
                background: rgba(0, 0, 0, 0.9);
                color: #58a6ff;
                transform: translateY(-2px);
            }

            .info-panel {
                position: fixed;
                bottom: 20px;
                left: 20px;
                background: rgba(0, 0, 0, 0.85);
                color: white;
                padding: 20px;
                border-radius: 12px;
                font-size: 13px;
                line-height: 1.5;
                max-width: 350px;
                z-index: 100;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }

            .info-panel h3 {
                margin: 0 0 15px 0;
                font-size: 16px;
                color: #58a6ff;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .controls {
                margin-top: 15px;
                padding-top: 15px;
                border-top: 1px solid rgba(255, 255, 255, 0.2);
                font-size: 12px;
                opacity: 0.8;
            }

            .tech-stack {
                margin-top: 10px;
                font-size: 12px;
                opacity: 0.7;
            }

            @media (max-width: 768px) {
                .header-links {
                    flex-direction: column;
                    top: 10px;
                    right: 10px;
                }

                .info-panel {
                    bottom: 10px;
                    left: 10px;
                    right: 10px;
                    max-width: none;
                    font-size: 12px;
                }

                .loading-subtext {
                    font-size: 14px;
                    padding: 0 20px;
                }
            }
        </style>
    </head>
    <body>
        <div id="loading">
            <div class="loading-spinner"></div>
            <div class="loading-text">bevy-osm-tiles</div>
            <div class="loading-subtext">
                üåç Loading Interactive OpenStreetMap City Visualizer<br />
                üì° Initializing WASM module and OSM integration<br />
                üéÆ Preparing 3D rendering with Bevy engine<br />
                ü¶Ä Powered by Rust WebAssembly
            </div>
        </div>

        <div id="error">
            <h2>‚ö†Ô∏è Loading Error</h2>
            <p id="error-message"></p>
            <button onclick="location.reload()">üîÑ Retry Loading</button>
        </div>

        <div class="header-links">
            <a
                href="https://github.com/konnektoren/bevy-osm-tiles"
                class="header-link"
                target="_blank"
            >
                üìÇ Source Code
            </a>
            <a
                href="https://crates.io/crates/bevy-osm-tiles"
                class="header-link"
                target="_blank"
            >
                üì¶ Crate
            </a>
            <a
                href="https://docs.rs/bevy-osm-tiles"
                class="header-link"
                target="_blank"
            >
                üìö Docs
            </a>
        </div>

        <div class="info-panel">
            <h3>üó∫Ô∏è Interactive OSM City Loader</h3>
            <div>
                <strong>Real-time OpenStreetMap Visualization</strong><br />
                ‚Ä¢ Type any city name to load live OSM data<br />
                ‚Ä¢ Cycle through feature sets (Urban, Transport, Natural,
                etc.)<br />
                ‚Ä¢ Adjust resolution from 250 to 8000 cells<br />
                ‚Ä¢ Explore cities in beautiful 3D
            </div>

            <div class="controls">
                <strong>üéÆ Controls:</strong><br />
                ‚Ä¢ Arrow keys: Navigate camera<br />
                ‚Ä¢ Alt + Mouse: Look around<br />
                ‚Ä¢ Page Up/Down: Vertical movement<br />
                ‚Ä¢ Ctrl: Speed boost<br />
                ‚Ä¢ Click buttons to change settings
            </div>

            <div class="tech-stack">
                Built with Rust ü¶Ä | Bevy üïäÔ∏è | WebAssembly üåê | OpenStreetMap üó∫Ô∏è
            </div>
        </div>

        <script type="module">
            let wasm;

            async function init() {
                try {
                    console.log(
                        "üöÄ Starting bevy-osm-tiles WASM initialization...",
                    );

                    // Import the WASM module
                    const wasmModule = await import(
                        "./interactive_city_loader.js"
                    );

                    console.log(
                        "üì¶ WASM module loaded, initializing Bevy app...",
                    );

                    // Initialize the WASM module
                    await wasmModule.default();

                    console.log("‚úÖ Bevy app initialized successfully!");

                    // Hide loading screen with smooth transition
                    const loading = document.getElementById("loading");
                    loading.classList.add("hidden");

                    // Remove loading screen after transition
                    setTimeout(() => {
                        loading.style.display = "none";
                    }, 500);

                    console.log("üéÆ Interactive OSM City Loader ready!");
                    console.log(
                        "üåç Try loading a city like 'Berlin', 'Tokyo', 'New York', or 'London'",
                    );
                } catch (error) {
                    console.error("‚ùå Failed to initialize WASM:", error);
                    showError(
                        `Failed to load bevy-osm-tiles: ${error.message}`,
                    );
                }
            }

            function showError(message) {
                const loading = document.getElementById("loading");
                const error = document.getElementById("error");
                const errorMessage = document.getElementById("error-message");

                loading.style.display = "none";
                errorMessage.textContent = message;
                error.style.display = "block";
            }

            // Handle WASM loading errors
            window.addEventListener("error", (event) => {
                if (
                    event.filename?.includes(".wasm") ||
                    event.message?.includes("wasm")
                ) {
                    showError(
                        "WebAssembly failed to load. Please make sure your browser supports WASM and refresh the page.",
                    );
                }
            });

            // Handle unhandled promise rejections
            window.addEventListener("unhandledrejection", (event) => {
                console.error("Unhandled promise rejection:", event.reason);
                if (
                    event.reason?.message?.includes("wasm") ||
                    event.reason?.message?.includes("module")
                ) {
                    showError(
                        "Module initialization failed. Please refresh and try again.",
                    );
                }
            });

            // Log browser compatibility info
            console.log("üîç Browser compatibility check:");
            console.log(
                "  - WebAssembly:",
                typeof WebAssembly !== "undefined"
                    ? "‚úÖ Supported"
                    : "‚ùå Not supported",
            );
            console.log(
                "  - WebGL:",
                document.createElement("canvas").getContext("webgl2")
                    ? "‚úÖ WebGL2"
                    : "‚ö†Ô∏è WebGL1 only",
            );

            // Start the application
            init();

            // Add some helpful console messages
            setTimeout(() => {
                if (!document.getElementById("error").style.display) {
                    console.log("üí° Tips:");
                    console.log(
                        "  - Try different cities: Paris, Mumbai, S√£o Paulo, Sydney",
                    );
                    console.log(
                        "  - Experiment with different feature sets and resolutions",
                    );
                    console.log(
                        "  - Higher resolutions show more detail but load slower",
                    );
                    console.log(
                        "  - Use transportation mode to see roads and railways clearly",
                    );
                }
            }, 3000);
        </script>
    </body>
</html>
